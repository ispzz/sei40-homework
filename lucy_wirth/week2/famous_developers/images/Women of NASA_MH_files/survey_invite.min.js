var iPerceptions,userAgent=window.navigator.userAgent,isIE=-1<userAgent.indexOf("MSIE ")||-1<userAgent.indexOf("Trident/");isIE||((iPerceptions=iPerceptions||{}).Wrapper={token:"eabaab3f-1019-419e-8fe2-aa24decf6449",inviteId:"IPinvite.eabaab3f-1019-419e-8fe2-aa24decf6449",inviteUrl:"https://npssurveyinvite.services.lego.com/InviteTriggers",engineId:"IPengine",definitionId:"IPdef.eabaab3f-1019-419e-8fe2-aa24decf6449",device:"",culture:"",sId:"",visits:"",visit:"",engineUrl:"https://npssurveyinvite.services.lego.com/v1/survey_engine.min.js",dataUrl:"",companyId:"",frameUrl:"https://npssurveyinvite.services.lego.com/v1/iframe.html",iFrameUrl:"https://npssurveyinvite.services.lego.com",frameId:"iPerceptionsFrame",visitsId:"iperceptions.com",pageUrl:location.href,init:function(){if(!/MSIE [67]\.(?!.*Trident[1-9])/.test(navigator.userAgent))try{this.sId=this.setAndGetCookie("ipe_s"),this.visits=JSON.parse(this.getStorageCookie(this.visitsId));var e=this.getStorageCookie(this.inviteId);e&&"null"!==e?this.store(this.inviteId,e):this.getJs(this.inviteUrl,this.store,this.inviteId)}catch(e){try{this.getJs(this.inviteUrl,this.inject,this.inviteId)}catch(e){}}},getApiObj:function(e){if(e)try{var t=JSON.parse(e);this.device=t.Device,this.culture=t.Culture,this.dataUrl=t.DataUrl.replace(/^(https?):\/\//,"//"),void 0!==this.visits&&this.visits&&this.visits instanceof Array||(this.visits=[]);for(var i=0;i<this.visits.length;i++)if(this.visits[i].id===this.token){this.visit=this.visits[i];break}this.visit=this.visit||{},this.visit.id=this.token,this.visit.history=this.visit.history||[];var n=this.visit.visitors||[];n.push({id:t.VisitorId,time:new Date,host:location.hostname}),this.visit.visitors=n.length<=10?n:n.slice(Math.max(n.length-10,1))}catch(e){}else window.console&&console.warn("iPerceptions Warning: Domain validation does not find "+window.location.hostname)},store:function(e,t){try{var i=iPerceptions.Wrapper;return i.getApiObj(t),i.setStorageCookie(e,t,null,"session"),void i.injectJs(i.engineId,i.engineUrl,null,i.injectDataScript,i)}catch(e){}},inject:function(e,t){var i=iPerceptions.Wrapper;try{i.getApiObj(t),i.injectJs(i.engineId,i.engineUrl),i.injectJs(i.definitionId,i.dataUrl,null,i.callEngine)}catch(e){}},injectJs:function(e,t,i,n,s){var o=document.createElement("script");o.id=e,t&&(o.src=t),i&&(o.text=i),o.type="text/javascript";i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(o,i),null!=n&&this.afterInjection(o,n,s)},afterInjection:function(e,t,i){e.readyState?e.onreadystatechange=function(){"loaded"!=e.readyState&&"complete"!=e.readyState||(e.onreadystatechange=null,t(i))}:e.onload=function(){t(i)}},getJs:function(e,t,i){var n,s;window.XDomainRequest?((n=new XDomainRequest).open("get",e+"?SecurityToken="+this.token),n.onload=function(){t(i,n.responseText)},n.send()):((s=new XMLHttpRequest).open("GET",e,!0),s.setRequestHeader("SecurityToken",this.token),s.onload=function(){t(i,this.response)},s.send(this.token))},injectDataScript:function(e){e.injectJs(e.definitionId,e.dataUrl,null,e.storeDef,e)},storeDef:function(e){try{sessionStorage.setItem(e.definitionId,JSON.stringify(ipDef))}catch(e){}e.callEngine()},callEngine:function(e,t){"string"==typeof e&&0<e.length&&(iPerceptions.Wrapper.pageUrl=e),"boolean"!=typeof t&&(t=!0);e=iPerceptions.Wrapper;"undefined"!=typeof ipDef&&ipDef&&0<ipDef.Invites.length&&(e.companyId=ipDef.Invites[0].CompanyId,"object"==typeof iPerceptions.ipEngine?iPerceptions.ipEngine.launch(ipDef,e.device,e.culture,e.visit,iPerceptions.Wrapper.pageUrl,t):setTimeout(e.callEngine(iPerceptions.Wrapper.pageUrl),500))},getCookie:function(e){for(var t,i=document.cookie.split(";"),n=0;n<i.length;n+=1){for(t=i[n];" "===t.charAt(0);)t=t.substring(1);if(-1!==t.indexOf(e))return t.substring(e.length+1,t.length)}return""},setCookie:function(e,t,i,n){void 0===n&&(n="Lax"),t&&(document.cookie=i?e+"="+t+";expires="+i.toGMTString()+";path=/;SameSite="+n+";"+("none"===n.toLowerCase()?"Secure":""):e+"="+t+";path=/;SameSite="+n+";"+("none"===n.toLowerCase()?"Secure":""))},setAndGetCookie:function(e){var t=this.getStorageCookie(e,"session");return""===t&&(t=this.guid(),this.setStorageCookie(e,t,null,"session")),t},setStorageCookie:function(e,t,i,n){try{"session"===n?sessionStorage.setItem(e,t):(this.setCookie(e,t,i),this.saveToFrame(e,t,i))}catch(e){}},getStorageCookie:function(e,t){var i;try{i="session"===t?sessionStorage.getItem(e):(localStorage.getItem(e),localStorage.removeItem(e))}catch(e){}return i||this.getCookie(e)},getPageViewed:function(e){var t,i,n;return"boolean"!=typeof e&&(e=!0),t=this.getStorageCookie("ipe."+this.companyId+".pageViewed","session"),n=this.getStorageCookie("ipe."+this.companyId+".pageViewedCount","session"),i=t?t.split(","):[],n=parseInt(n)||0,iPerceptions.Wrapper.pageUrl!==i[i.length-1]&&e&&((i=[]).push(iPerceptions.Wrapper.pageUrl),n+=1),t=i.join(","),this.setStorageCookie("ipe."+this.companyId+".pageViewed",t,null,"session"),this.setCookie("ipe."+this.companyId+".pageViewedCount",n),n},getInvitesKey:function(){return"ipe."+this.companyId+".winning"},getInvites:function(){return this.getIframeSessionStorage(this.getInvitesKey())},setInvites:function(e){this.setIframeSessionStorage(this.getInvitesKey(),e)},updateVisit:function(e,t){for(var i=!1,n=0;n<this.visits.length&&!i;n++)this.visits[n].id===e.id&&(this.visits[n]=e,i=!0);i||this.visits.push(e),this.setStorageCookie(this.visitsId,JSON.stringify(this.visits),t)},objToString:function(e){var t,i="";for(t in e)e.hasOwnProperty(t)&&(i+=t+"::"+e[t]+"\n");return i},seed:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},guid:function(){return this.seed()+this.seed()+"-"+this.seed()+"-"+this.seed()+"-"+this.seed()+"-"+this.seed()+this.seed()+this.seed()},stringToObj:function(e){try{var t,i=JSON.parse(e);for(t in i)i.hasOwnProperty(t)&&"string"==typeof i[t]&&2<i[t].length&&"{"==i[t][0]&&"}"==i[t][i[t].length-1]&&(i[t]=this.stringToObj(i[t]));return i}catch(e){}},addEvent:function(e,t){window.addEventListener?window.addEventListener(e,t):window.attachEvent("on"+e,t)},saveToFrame:function(e,t,i){var n=iPerceptions.Wrapper;win=document.getElementById(this.frameId).contentWindow,win.postMessage(JSON.stringify({key:e,method:"set",data:t}),n.iFrameUrl)},setIframeSessionStorage:function(e,t){var i=iPerceptions.Wrapper,n=document.getElementById(this.frameId).contentWindow;this.setStorageCookie(e,t,null,"session"),n.postMessage(JSON.stringify({key:e,method:"setsession",data:t}),i.iFrameUrl)},getSessionEventObj:{invites:null,handleEvent:function(e){var t;0<=e.origin.indexOf(iPerceptions.Wrapper.iFrameUrl)&&("universalgetsession"==(t=JSON.parse(e.data)).source&&(e=iPerceptions.Wrapper,iPerceptions.ipEngine.evaluateRate(this.invites,t.value,ipDef,e.device,e.culture,e.visit,e.sId,e.token),window.removeEventListener("message",iPerceptions.Wrapper.getSessionEventObj)))}},getIframeSessionStorage:function(e,t){try{var i=iPerceptions.Wrapper;document.getElementById(i.frameId).contentWindow.postMessage(JSON.stringify({key:e,method:"getsession"}),i.iFrameUrl),iPerceptions.Wrapper.getSessionEventObj.invites=t,i.addEvent("message",iPerceptions.Wrapper.getSessionEventObj)}catch(e){}},saveAndRestoreLocalStorage:function(){var e=iPerceptions.Wrapper;document.getElementById(e.frameId).contentWindow.postMessage(JSON.stringify({key:e.visitsId,method:"get"}),e.iFrameUrl),setTimeout(function(){e.init()},300)},storageFromFrame:function(){try{var e,i,n=iPerceptions.Wrapper;document.getElementById(n.frameId)||((e=document.createElement("iframe")).src=n.frameUrl,e.style.display="none",e.id=n.frameId,e.title=n.frameId,document.getElementsByTagName("body")[0].appendChild(e),i=n.visitsId,n.afterInjection(e,n.saveAndRestoreLocalStorage),n.addEvent("message",function(e){try{var t;0<=e.origin.indexOf(iPerceptions.Wrapper.iFrameUrl)&&("universal"==(t=JSON.parse(e.data)).source&&t.value&&n.setStorageCookie(i,t.value))}catch(e){}}))}catch(e){}},exec:function(e,t){iPerceptions.Wrapper.callEngine(e,t)},attachPushStateHandler:function(){var t=window.history.pushState;window.history.pushState=function(e){return document.cookie.match(/IPE_M_[0-9]{6}/)||iPerceptions.Wrapper.exec(document.location.href,!0),t.apply(window.history,arguments)}},onDocumentComplete:function(){iPerceptions.Wrapper.storageFromFrame(),iPerceptions.Wrapper.attachPushStateHandler()}},"complete"==document.readyState?iPerceptions.Wrapper.onDocumentComplete():iPerceptions.Wrapper.addEvent("load",iPerceptions.Wrapper.onDocumentComplete));